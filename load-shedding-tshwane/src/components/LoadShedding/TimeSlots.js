const TIMESLOTS = [{
  timeslot: ['01:00', '03:30'],
  start: 60,
  end: 210,
  stages: [
      [1, 13, 9, 5, 2, 14, 10, 6, 3, 15, 11, 7, 4, 16, 12, 8, 5, 1, 13, 9, 6, 2, 14, 10, 7, 3, 15, 11, 8, 4, 16],
      [5, 1, 13, 9, 6, 2, 14, 10, 7, 3, 15, 11, 8, 4, 16, 12, 9, 5, 1, 13, 10, 6, 2, 14, 11, 7, 3, 15, 12, 8, 4],
      [9, 5, 1, 13, 10, 6, 2, 14, 11, 7, 3, 15, 12, 8, 4, 16, 13, 9, 5, 1, 14, 10, 6, 2, 15, 11, 7, 3, 16, 12, 8],
      [13, 9, 5, 1, 14, 10, 6, 2, 15, 11, 7, 3, 16, 12, 8, 4, 1, 13, 9, 5, 2, 14, 10, 6, 3, 15, 11, 7, 4, 16, 12],
      [11, 12, 8, 4, 16, 13, 9, 5, 1, 14, 10, 6, 2, 15, 11, 7, 3, 16, 12, 8, 4, 1, 13, 9, 5, 2, 14, 10, 6, 3, 15],
      [15, 16, 12, 8, 4, 1, 13, 9, 5, 2, 14, 10, 6, 3, 15, 11, 7, 4, 16, 12, 8, 5, 1, 13, 9, 6, 2, 14, 10, 7, 3],
      [3, 4, 16, 12, 8, 5, 1, 13, 9, 6, 2, 14, 10, 7, 3, 15, 11, 8, 4, 16, 12, 9, 5, 1, 13, 10, 6, 2, 14, 11, 7],
      [7, 8, 4, 16, 12, 9, 5, 1, 13, 10, 6, 2, 14, 11, 7, 3, 15, 12, 8, 4, 16, 13, 9, 5, 1, 14, 10, 6, 2, 15, 11],
  ]
}, {
  timeslot: ['03:00', '05:30'],
  start: 180,
  end: 330,
  stages: [
      [2, 14, 10, 6, 3, 15, 11, 7, 4, 16, 12, 8, 5, 1, 13, 9, 6, 2, 14, 10, 7, 3, 15, 11, 8, 4, 16, 12, 9, 5, 1],
      [6, 2, 14, 10, 7, 3, 15, 11, 8, 4, 16, 12, 9, 5, 1, 13, 10, 6, 2, 14, 11, 7, 3, 15, 12, 8, 4, 16, 13, 9, 5],
      [10, 6, 2, 14, 11, 7, 3, 15, 12, 8, 4, 16, 13, 9, 5, 1, 14, 10, 6, 2, 15, 11, 7, 3, 16, 12, 8, 4, 1, 13, 9],
      [14, 10, 6, 2, 15, 11, 7, 3, 16, 12, 8, 4, 1, 13, 9, 5, 2, 14, 10, 6, 3, 15, 11, 7, 4, 16, 12, 8, 5, 1, 13],
      [1, 13, 9, 5, 2, 14, 10, 6, 3, 15, 11, 7, 4, 16, 12, 8, 5, 1, 13, 9, 6, 2, 14, 10, 7, 3, 15, 11, 8, 4, 16],
      [5, 1, 13, 9, 6, 2, 14, 10, 7, 3, 15, 11, 8, 4, 16, 12, 9, 5, 1, 13, 10, 6, 2, 14, 11, 7, 3, 15, 12, 8, 4],
      [9, 5, 1, 13, 10, 6, 2, 14, 11, 7, 3, 15, 12, 8, 4, 16, 13, 9, 5, 1, 14, 10, 6, 2, 15, 11, 7, 3, 16, 12, 8],
      [13, 9, 5, 1, 14, 10, 6, 2, 15, 11, 7, 3, 16, 12, 8, 4, 1, 13, 9, 5, 2, 14, 10, 6, 3, 15, 11, 7, 4, 16, 12],
  ]
}, {
  timeslot: ['05:00', '07:30'],
  start: 300,
  end: 450,
  stages: [
      [3, 15, 11, 7, 4, 16, 12, 8, 5, 1, 13, 9, 6, 2, 14, 10, 7, 3, 15, 11, 8, 4, 16, 12, 9, 5, 1, 13, 10, 6, 2],
      [7, 3, 15, 11, 8, 4, 16, 12, 9, 5, 1, 13, 10, 6, 2, 14, 11, 7, 3, 15, 12, 8, 4, 16, 13, 9, 5, 1, 14, 10, 6],
      [11, 7, 3, 15, 12, 8, 4, 16, 13, 9, 5, 1, 14, 10, 6, 2, 15, 11, 7, 3, 16, 12, 8, 4, 1, 13, 9, 5, 2, 14, 10],
      [15, 11, 7, 3, 16, 12, 8, 4, 1, 13, 9, 5, 2, 14, 10, 6, 3, 15, 11, 7, 4, 16, 12, 8, 5, 1, 13, 9, 6, 2, 14],
      [2, 14, 10, 6, 3, 15, 11, 7, 4, 16, 12, 8, 5, 1, 13, 9, 6, 2, 14, 10, 7, 3, 15, 11, 8, 4, 16, 12, 9, 5, 1],
      [6, 2, 14, 10, 7, 3, 15, 11, 8, 4, 16, 12, 9, 5, 1, 13, 10, 6, 2, 14, 11, 7, 3, 15, 12, 8, 4, 16, 13, 9, 5],
      [10, 6, 2, 14, 11, 7, 3, 15, 12, 8, 4, 16, 13, 9, 5, 1, 14, 10, 6, 2, 15, 11, 7, 3, 16, 12, 8, 4, 1, 13, 9],
      [14, 10, 6, 2, 15, 11, 7, 3, 16, 12, 8, 4, 1, 13, 9, 5, 2, 14, 10, 6, 3, 15, 11, 7, 4, 16, 12, 8, 5, 1, 13],
  ]
}, {
  timeslot: ['07:00', '09:30'],
  start: 420,
  end: 570,
  stages: [
      [4, 16, 12, 8, 5, 1, 13, 9, 6, 2, 14, 10, 7, 3, 15, 11, 8, 4, 16, 12, 9, 5, 1, 13, 10, 6, 2, 14, 11, 7, 3],
      [8, 4, 16, 12, 9, 5, 1, 13, 10, 6, 2, 14, 11, 7, 3, 15, 12, 8, 4, 16, 13, 9, 5, 1, 14, 10, 6, 2, 15, 11, 7],
      [12, 8, 4, 16, 13, 9, 5, 1, 14, 10, 6, 2, 15, 11, 7, 3, 16, 12, 8, 4, 1, 13, 9, 5, 2, 14, 10, 6, 3, 15, 11],
      [16, 12, 8, 4, 1, 13, 9, 5, 2, 14, 10, 6, 3, 15, 11, 7, 4, 16, 12, 8, 5, 1, 13, 9, 6, 2, 14, 10, 7, 3, 15],
      [3, 15, 11, 7, 4, 16, 12, 8, 5, 1, 13, 9, 6, 2, 14, 10, 7, 3, 15, 11, 8, 4, 16, 12, 9, 5, 1, 13, 10, 6, 2],
      [7, 3, 15, 11, 8, 4, 16, 12, 9, 5, 1, 13, 10, 6, 2, 14, 11, 7, 3, 15, 12, 8, 4, 16, 13, 9, 5, 1, 14, 10, 6],
      [11, 7, 3, 15, 12, 8, 4, 16, 13, 9, 5, 1, 14, 10, 6, 2, 15, 11, 7, 3, 16, 12, 8, 4, 1, 13, 9, 5, 2, 14, 10],
      [15, 11, 7, 3, 16, 12, 8, 4, 1, 13, 9, 5, 2, 14, 10, 6, 3, 15, 11, 7, 4, 16, 12, 8, 5, 1, 13, 9, 6, 2, 14],
  ]
}, {
  timeslot: ['09:00', '11:30'],
  start: 540,
  end: 690,
  stages: [
      [5, 1, 13, 9, 6, 2, 14, 10, 7, 3, 15, 11, 8, 4, 16, 12, 9, 5, 1, 13, 10, 6, 2, 14, 11, 7, 3, 15, 12, 8, 4],
      [9, 5, 1, 13, 10, 6, 2, 14, 11, 7, 3, 15, 12, 8, 4, 16, 13, 9, 5, 1, 14, 10, 6, 2, 15, 11, 7, 3, 16, 12, 8],
      [13, 9, 5, 1, 14, 10, 6, 2, 15, 11, 7, 3, 16, 12, 8, 4, 1, 13, 9, 5, 2, 14, 10, 6, 3, 15, 11, 7, 4, 16, 12],
      [1, 13, 9, 5, 2, 14, 10, 6, 3, 15, 11, 7, 4, 16, 12, 8, 5, 1, 13, 9, 6, 2, 14, 10, 7, 3, 15, 11, 8, 4, 16],
      [4, 16, 12, 8, 5, 1, 13, 9, 6, 2, 14, 10, 7, 3, 15, 11, 8, 4, 16, 12, 9, 5, 1, 13, 10, 6, 2, 14, 11, 7, 3],
      [8, 4, 16, 12, 9, 5, 1, 13, 10, 6, 2, 14, 11, 7, 3, 15, 12, 8, 4, 16, 13, 9, 5, 1, 14, 10, 6, 2, 15, 11, 7],
      [12, 8, 4, 16, 13, 9, 5, 1, 14, 10, 6, 2, 15, 11, 7, 3, 16, 12, 8, 4, 1, 13, 9, 5, 2, 14, 10, 6, 3, 15, 11],
      [16, 12, 8, 4, 1, 13, 9, 5, 2, 14, 10, 6, 3, 15, 11, 7, 4, 16, 12, 8, 5, 1, 13, 9, 6, 2, 14, 10, 7, 3, 15],
  ]
}, {
  timeslot: ['11:00', '13:30'],
  start: 660,
  end: 810,
  stages: [
      [6, 2, 14, 10, 7, 3, 15, 11, 8, 4, 16, 12, 9, 5, 1, 13, 10, 6, 2, 14, 11, 7, 3, 15, 12, 8, 4, 16, 13, 9, 5],
      [10, 6, 2, 14, 11, 7, 3, 15, 12, 8, 4, 16, 13, 9, 5, 1, 14, 10, 6, 2, 15, 11, 7, 3, 16, 12, 8, 4, 1, 13, 9],
      [14, 10, 6, 2, 15, 11, 7, 3, 16, 12, 8, 4, 1, 13, 9, 5, 2, 14, 10, 6, 3, 15, 11, 7, 4, 16, 12, 8, 5, 1, 13],
      [2, 14, 10, 6, 3, 15, 11, 7, 4, 16, 12, 8, 5, 1, 13, 9, 6, 2, 14, 10, 7, 3, 15, 11, 8, 4, 16, 12, 9, 5, 1],
      [5, 1, 13, 9, 6, 2, 14, 10, 7, 3, 15, 11, 8, 4, 16, 12, 9, 5, 1, 13, 10, 6, 2, 14, 11, 7, 3, 15, 12, 8, 4],
      [9, 5, 1, 13, 10, 6, 2, 14, 11, 7, 3, 15, 12, 8, 4, 16, 13, 9, 5, 1, 14, 10, 6, 2, 15, 11, 7, 3, 16, 12, 8],
      [13, 9, 5, 1, 14, 10, 6, 2, 15, 11, 7, 3, 16, 12, 8, 4, 1, 13, 9, 5, 2, 14, 10, 6, 3, 15, 11, 7, 4, 16, 12],
      [1, 13, 9, 5, 2, 14, 10, 6, 3, 15, 11, 7, 4, 16, 12, 8, 5, 1, 13, 9, 6, 2, 14, 10, 7, 3, 15, 11, 8, 4, 16],
  ]
}, {
  timeslot: ['13:00', '15:30'],
  start: 780,
  end: 930,
  stages: [
      [7, 3, 15, 11, 8, 4, 16, 12, 9, 5, 1, 13, 10, 6, 2, 14, 11, 7, 3, 15, 12, 8, 4, 16, 13, 9, 5, 1, 14, 10, 6],
      [11, 7, 3, 15, 12, 8, 4, 16, 13, 9, 5, 1, 14, 10, 6, 2, 15, 11, 7, 3, 16, 12, 8, 4, 1, 13, 9, 5, 2, 14, 10],
      [15, 11, 7, 3, 16, 12, 8, 4, 1, 13, 9, 5, 2, 14, 10, 6, 3, 15, 11, 7, 4, 16, 12, 8, 5, 1, 13, 9, 6, 2, 14],
      [3, 15, 11, 7, 4, 16, 12, 8, 5, 1, 13, 9, 6, 2, 14, 10, 7, 3, 15, 11, 8, 4, 16, 12, 9, 5, 1, 13, 10, 6, 2],
      [6, 2, 14, 10, 7, 3, 15, 11, 8, 4, 16, 12, 9, 5, 1, 13, 10, 6, 2, 14, 11, 7, 3, 15, 12, 8, 4, 16, 13, 9, 5],
      [10, 6, 2, 14, 11, 7, 3, 15, 12, 8, 4, 16, 13, 9, 5, 1, 14, 10, 6, 2, 15, 11, 7, 3, 16, 12, 8, 4, 1, 13, 9],
      [14, 10, 6, 2, 15, 11, 7, 3, 16, 12, 8, 4, 1, 13, 9, 5, 2, 14, 10, 6, 3, 15, 11, 7, 4, 16, 12, 8, 5, 1, 13],
      [2, 14, 10, 6, 3, 15, 11, 7, 4, 16, 12, 8, 5, 1, 13, 9, 6, 2, 14, 10, 7, 3, 15, 11, 8, 4, 16, 12, 9, 5, 1],
  ]
}, {
  timeslot: ['15:00', '17:30'],
  start: 900,
  end: 1050,
  stages: [
      [8, 4, 16, 12, 9, 5, 1, 13, 10, 6, 2, 14, 11, 7, 3, 15, 12, 8, 4, 16, 13, 9, 5, 1, 14, 10, 6, 2, 15, 11, 7],
      [12, 8, 4, 16, 13, 9, 5, 1, 14, 10, 6, 2, 15, 11, 7, 3, 16, 12, 8, 4, 1, 13, 9, 5, 2, 14, 10, 6, 3, 15, 11],
      [16, 12, 8, 4, 1, 13, 9, 5, 2, 14, 10, 6, 3, 15, 11, 7, 4, 16, 12, 8, 5, 1, 13, 9, 6, 2, 14, 10, 7, 3, 15],
      [4, 16, 12, 8, 5, 1, 13, 9, 6, 2, 14, 10, 7, 3, 15, 11, 8, 4, 16, 12, 9, 5, 1, 13, 10, 6, 2, 14, 11, 7, 3],
      [7, 3, 15, 11, 8, 4, 16, 12, 9, 5, 1, 13, 10, 6, 2, 14, 11, 7, 3, 15, 12, 8, 4, 16, 13, 9, 5, 1, 14, 10, 6],
      [11, 7, 3, 15, 12, 8, 4, 16, 13, 9, 5, 1, 14, 10, 6, 2, 15, 11, 7, 3, 16, 12, 8, 4, 1, 13, 9, 5, 2, 14, 10],
      [15, 11, 7, 3, 16, 12, 8, 4, 1, 13, 9, 5, 2, 14, 10, 6, 3, 15, 11, 7, 4, 16, 12, 8, 5, 1, 13, 9, 6, 2, 14],
      [3, 15, 11, 7, 4, 16, 12, 8, 5, 1, 13, 9, 6, 2, 14, 10, 7, 3, 15, 11, 8, 4, 16, 12, 9, 5, 1, 13, 10, 6, 2],
  ]
}, {
  timeslot: ['17:00', '19:30'],
  start: 1020,
  end: 1170,
  stages: [
      [9, 5, 1, 13, 10, 6, 2, 14, 11, 7, 3, 15, 12, 8, 4, 16, 13, 9, 5, 1, 14, 10, 6, 2, 15, 11, 7, 3, 16, 12, 8],
      [13, 9, 5, 1, 14, 10, 6, 2, 15, 11, 7, 3, 16, 12, 8, 4, 1, 13, 9, 5, 2, 14, 10, 6, 3, 15, 11, 7, 4, 16, 12],
      [1, 13, 9, 5, 2, 14, 10, 6, 3, 15, 11, 7, 4, 16, 12, 8, 5, 1, 13, 9, 6, 2, 14, 10, 7, 3, 15, 11, 8, 4, 16],
      [5, 1, 13, 9, 6, 2, 14, 10, 7, 3, 15, 11, 8, 4, 16, 12, 9, 5, 1, 13, 10, 6, 2, 14, 11, 7, 3, 15, 12, 8, 4],
      [8, 4, 16, 12, 9, 5, 1, 13, 10, 6, 2, 14, 11, 7, 3, 15, 12, 8, 4, 16, 13, 9, 5, 1, 14, 10, 6, 2, 15, 11, 7],
      [12, 8, 4, 16, 13, 9, 5, 1, 14, 10, 6, 2, 15, 11, 7, 3, 16, 12, 8, 4, 1, 13, 9, 5, 2, 14, 10, 6, 3, 15, 11],
      [16, 12, 8, 4, 1, 13, 9, 5, 2, 14, 10, 6, 3, 15, 11, 7, 4, 16, 12, 8, 5, 1, 13, 9, 6, 2, 14, 10, 7, 3, 15],
      [4, 16, 12, 8, 5, 1, 13, 9, 6, 2, 14, 10, 7, 3, 15, 11, 8, 4, 16, 12, 9, 5, 1, 13, 10, 6, 2, 14, 11, 7, 3],
  ]
}, {
  timeslot: ['19:00', '21:30'],
  start: 1140,
  end: 1290,
  stages: [
      [10, 6, 2, 14, 11, 7, 3, 15, 12, 8, 4, 16, 13, 9, 5, 1, 14, 10, 6, 2, 15, 11, 7, 3, 16, 12, 8, 4, 1, 13, 9],
      [14, 10, 6, 2, 15, 11, 7, 3, 16, 12, 8, 4, 1, 13, 9, 5, 2, 14, 10, 6, 3, 15, 11, 7, 4, 16, 12, 8, 5, 1, 13],
      [2, 14, 10, 6, 3, 15, 11, 7, 4, 16, 12, 8, 5, 1, 13, 9, 6, 2, 14, 10, 7, 3, 15, 11, 8, 4, 16, 12, 9, 5, 1],
      [6, 2, 14, 10, 7, 3, 15, 11, 8, 4, 16, 12, 9, 5, 1, 13, 10, 6, 2, 14, 11, 7, 3, 15, 12, 8, 4, 16, 13, 9, 5],
      [9, 5, 1, 13, 10, 6, 2, 14, 11, 7, 3, 15, 12, 8, 4, 16, 13, 9, 5, 1, 14, 10, 6, 2, 15, 11, 7, 3, 16, 12, 8],
      [13, 9, 5, 1, 14, 10, 6, 2, 15, 11, 7, 3, 16, 12, 8, 4, 1, 13, 9, 5, 2, 14, 10, 6, 3, 15, 11, 7, 4, 16, 12],
      [1, 13, 9, 5, 2, 14, 10, 6, 3, 15, 11, 7, 4, 16, 12, 8, 5, 1, 13, 9, 6, 2, 14, 10, 7, 3, 15, 11, 8, 4, 16],
      [5, 1, 13, 9, 6, 2, 14, 10, 7, 3, 15, 11, 8, 4, 16, 12, 9, 5, 1, 13, 10, 6, 2, 14, 11, 7, 3, 15, 12, 8, 4],
  ]
}, {
  timeslot: ['21:00', '23:30'],
  start: 1260,
  end: 1410,
  stages: [
      [11, 7, 3, 15, 12, 8, 4, 16, 13, 9, 5, 1, 14, 10, 6, 2, 15, 11, 7, 3, 16, 12, 8, 4, 1, 13, 9, 5, 2, 14, 10],
      [15, 11, 7, 3, 16, 12, 8, 4, 1, 13, 9, 5, 2, 14, 10, 6, 3, 15, 11, 7, 4, 16, 12, 8, 5, 1, 13, 9, 6, 2, 14],
      [3, 15, 11, 7, 4, 16, 12, 8, 5, 1, 13, 9, 6, 2, 14, 10, 7, 3, 15, 11, 8, 4, 16, 12, 9, 5, 1, 13, 10, 6, 2],
      [7, 3, 15, 11, 8, 4, 16, 12, 9, 5, 1, 13, 10, 6, 2, 14, 11, 7, 3, 15, 12, 8, 4, 16, 13, 9, 5, 1, 14, 10, 6],
      [10, 6, 2, 14, 11, 7, 3, 15, 12, 8, 4, 16, 13, 9, 5, 1, 14, 10, 6, 2, 15, 11, 7, 3, 16, 12, 8, 4, 1, 13, 9],
      [14, 10, 6, 2, 15, 11, 7, 3, 16, 12, 8, 4, 1, 13, 9, 5, 2, 14, 10, 6, 3, 15, 11, 7, 4, 16, 12, 8, 5, 1, 13],
      [2, 14, 10, 6, 3, 15, 11, 7, 4, 16, 12, 8, 5, 1, 13, 9, 6, 2, 14, 10, 7, 3, 15, 11, 8, 4, 16, 12, 9, 5, 1],
      [6, 2, 14, 10, 7, 3, 15, 11, 8, 4, 16, 12, 9, 5, 1, 13, 10, 6, 2, 14, 11, 7, 3, 15, 12, 8, 4, 16, 13, 9, 5],
  ]
}, {
  timeslot: ['23:00', '01:30'],
  start: 1380,
  end: 1530,
  stages: [
      [12, 8, 4, 16, 13, 9, 5, 1, 14, 10, 6, 2, 15, 11, 7, 3, 16, 12, 8, 4, 1, 13, 9, 5, 2, 14, 10, 6, 3, 15, 11],
      [16, 12, 8, 4, 1, 13, 9, 5, 2, 14, 10, 6, 3, 15, 11, 7, 4, 16, 12, 8, 5, 1, 13, 9, 6, 2, 14, 10, 7, 3, 15],
      [4, 16, 12, 8, 5, 1, 13, 9, 6, 2, 14, 10, 7, 3, 15, 11, 8, 4, 16, 12, 9, 5, 1, 13, 10, 6, 2, 14, 11, 7, 3],
      [8, 4, 16, 12, 9, 5, 1, 13, 10, 6, 2, 14, 11, 7, 3, 15, 12, 8, 4, 16, 13, 9, 5, 1, 14, 10, 6, 2, 15, 11, 7],
      [11, 7, 3, 15, 12, 8, 4, 16, 13, 9, 5, 1, 14, 10, 6, 2, 15, 11, 7, 3, 16, 12, 8, 4, 1, 13, 9, 5, 2, 14, 10],
      [15, 11, 7, 3, 16, 12, 8, 4, 1, 13, 9, 5, 2, 14, 10, 6, 3, 15, 11, 7, 4, 16, 12, 8, 5, 1, 13, 9, 6, 2, 14],
      [3, 15, 11, 7, 4, 16, 12, 8, 5, 1, 13, 9, 6, 2, 14, 10, 7, 3, 15, 11, 8, 4, 16, 12, 9, 5, 1, 13, 10, 6, 2],
      [7, 3, 15, 11, 8, 4, 16, 12, 9, 5, 1, 13, 10, 6, 2, 14, 11, 7, 3, 15, 12, 8, 4, 16, 13, 9, 5, 1, 14, 10, 6],
  ]
}];

const between = (value, lower, upper) => (lower <= value && value < upper);

const dateToMinute = date => date.getHours() * 60 + date.getMinutes();

export default (stage, group, currentDate) => {
  let currentMinute = dateToMinute(currentDate);
  let date = new Date(currentDate);

  stage = stage - 1;
  let today = true;

  while (true) {
    const dom = date.getDate() - 1;
    const minute = dateToMinute(date);

    for (const { timeslot, start, end, stages } of TIMESLOTS) {
      if (today && minute > end) {
        continue;
      }

      // TODO: Stage 5-8 is cumulative
      if (stages[stage][dom] === group) {
        return {
          timeslot,
          current: (between(currentMinute, start, end) || between(currentMinute + 1440, start, end)),
          date,
        };
      }
    }

    // No matching timeslot
    // Add one hour / 3600 seconds to current date
    date = new Date(date.getTime() + 3600000);
    if (today && date.getHours() === 0) {
      today = false;
    }
  }
};
